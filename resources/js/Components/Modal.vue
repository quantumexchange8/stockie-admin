<script setup>
import { useForm, router } from '@inertiajs/vue3';
import { computed, onMounted, onUnmounted, watch } from 'vue';
import { TimesIcon } from '@/Components/Icons/solid';
import Button from './Button.vue';
import {
  TransitionRoot,
  TransitionChild,
  Dialog,
  DialogPanel,
  DialogTitle,
} from '@headlessui/vue'

const props = defineProps({
    title: String,
    show: {
        type: Boolean,
        default: false,
    },
    maxWidth: {
        type: String,
        default: '2xl',
    },
    withHeader: {
        type: Boolean,
        default: true,
    },
    deleteConfirmation: {
        type: Boolean,
        default: false,
    },
    confirmationTitle: {
        type: String,
        default: '',
    },
    confirmationMessage: {
        type: String,
        default: '',
    },
    deleteUrl: {
        type: String,
        default: '',
    },
    closeable: {
        type: Boolean,
        default: true,
    },
});

const emit = defineEmits(['close']);

watch(
    () => props.show,
    () => {
        if (props.show) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = null;
        }
    }
);

const close = () => {
    if (props.closeable) {
        emit('close');
    }
};

const closeOnEscape = (e) => {
    if (e.key === 'Escape' && props.show) {
        close();
    }
};

onMounted(() => document.addEventListener('keydown', closeOnEscape));

onUnmounted(() => {
    document.removeEventListener('keydown', closeOnEscape);
    document.body.style.overflow = null;
});

const maxWidthClass = computed(() => {
    return {
        '2xs': 'sm:max-w-[333px]',
        'xs': 'sm:max-w-[370px]',
        'sm': 'sm:max-w-[574px]',
        'md': 'sm:max-w-[746px]',
        'lg': 'sm:max-w-[1080px]',
    }[props.maxWidth];
});

const deleteRecord = () => {
    router.delete(props.deleteUrl, {
        preserveScroll: true,
        preserveState: 'errors',
        onSuccess: () => close(),
    });
};

</script>

<template>
    <TransitionRoot appear :show="show" as="template">
        <Dialog as="div" @close="close" class="relative z-20">
            <TransitionChild
                as="template"
                enter="duration-300 ease-out"
                enter-from="opacity-0"
                enter-to="opacity-100"
                leave="duration-200 ease-in"
                leave-from="opacity-100"
                leave-to="opacity-0"
            >
                <div class="fixed inset-0 bg-black/25" />
            </TransitionChild>

            <div class="fixed inset-0 overflow-y-auto">
                <div
                    class="flex min-h-dvh items-center justify-center p-4 text-center"
                >
                    <TransitionChild
                        as="template"
                        enter="duration-300 ease-out"
                        enter-from="opacity-0 scale-95"
                        enter-to="opacity-100 scale-100"
                        leave="duration-200 ease-in"
                        leave-from="opacity-100 scale-100"
                        leave-to="opacity-0 scale-95"
                    >
                        <DialogPanel
                            class="transform w-full max-h-[95%] fixed rounded-[5px] bg-white text-left align-middle shadow-xl transition-all"
                            :class="[
                                maxWidthClass,
                                !props.deleteConfirmation ? 'p-6' : 'flex flex-col gap-9',
                            ]"
                        >
                            <template v-if="!props.deleteConfirmation">
                                <DialogTitle
                                    :as="'div'"
                                    class="flex justify-between items-start self-stretch pb-6"
                                    v-if="props.withHeader"
                                >
                                    <p class="text-center text-primary-950 text-md font-medium">{{ title }}</p>
                                    <TimesIcon
                                        class="text-primary-900 hover:text-primary-800 hover:cursor-pointer"
                                        @click="close"
                                    />
                                </DialogTitle>
                                <slot></slot>
                            </template>
                            <template v-else>
                                <div class="bg-primary-50 pt-6 flex items-center justify-center rounded-t-[5px]">
                                    <svg width="243" height="136" viewBox="0 0 243 136" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M22 134.807C22 77.4759 68.4759 31 125.807 31C183.138 31 229.614 77.4759 229.614 134.807V136H22V134.807Z" fill="#FFE1E2"/>
                                        <path d="M206.674 135.836H161.389L161.38 135.581L159.218 73.4858H208.845L206.674 135.836ZM161.897 135.308H206.166L208.3 74.0139H159.762L161.897 135.308Z" fill="#3F3D56"/>
                                        <path d="M172.192 84.9912H168.747V127.79H172.192V84.9912Z" fill="#3F3D56"/>
                                        <path d="M185.753 84.9912H182.309V127.79H185.753V84.9912Z" fill="#3F3D56"/>
                                        <path d="M199.316 84.9912H195.871V127.79H199.316V84.9912Z" fill="#3F3D56"/>
                                        <path d="M237.621 91.7202L237.399 91.5791L181.148 55.8863L186.028 48.1338L186.25 48.2748L242.5 83.9675L237.621 91.7202ZM181.874 55.722L237.457 90.9915L241.774 84.132L186.192 48.8622L181.874 55.722Z" fill="#3F3D56"/>
                                        <path d="M224.04 53.0095C222.405 51.9705 220.507 51.4243 218.572 51.4357C216.637 51.4471 214.746 52.0157 213.123 53.0739C211.501 54.1321 210.214 55.6355 209.417 57.4058C208.62 59.1761 208.345 61.1389 208.625 63.0613L211.307 64.7632C210.633 63.1917 210.478 61.4448 210.864 59.7783C211.251 58.1117 212.158 56.6131 213.454 55.5019C214.75 54.3906 216.366 53.7251 218.065 53.6028C219.765 53.4805 221.459 53.9078 222.9 54.8221C224.34 55.7364 225.451 57.0898 226.07 58.684C226.689 60.2782 226.783 62.0295 226.339 63.6814C225.895 65.3334 224.936 66.7993 223.603 67.8644C222.269 68.9295 220.631 69.538 218.928 69.6006L221.61 71.3025C223.46 70.7324 225.108 69.6413 226.359 68.1588C227.609 66.6763 228.41 64.8647 228.666 62.9389C228.922 61.013 228.623 59.0539 227.803 57.2939C226.983 55.5339 225.678 54.047 224.042 53.0095H224.04Z" fill="#3F3D56"/>
                                        <path d="M51.4297 135.482H14.458C14.458 135.482 13.7086 124.446 18.1425 124.32C22.5765 124.195 22.0769 129.211 27.6353 122.313C33.1936 115.416 39.9382 115.792 40.8125 119.868C41.6869 123.944 39.1265 127.205 43.8102 126.201C48.494 125.198 55.2391 127.832 51.4297 135.482Z" fill="#E6E6E6"/>
                                        <path d="M32.3202 135.485L32.1953 135.48C32.4864 128.213 34.0018 123.545 35.2222 120.908C36.547 118.044 37.8236 116.885 37.8365 116.874L37.9196 116.968C37.907 116.979 36.6453 118.127 35.3311 120.97C34.1175 123.596 32.6103 128.246 32.3202 135.485Z" fill="white"/>
                                        <path d="M45.7 135.499L45.5801 135.464C46.5099 132.385 48.186 129.585 50.4582 127.315L50.5421 127.408C48.2867 129.662 46.623 132.442 45.7 135.499Z" fill="white"/>
                                        <path d="M20.2814 135.491L20.1575 135.474C20.5607 132.749 20.1342 129.966 18.934 127.49C18.442 126.451 17.7907 125.496 17.0039 124.66L17.0904 124.57C17.8879 125.416 18.5482 126.382 19.0471 127.434C20.258 129.933 20.6883 132.742 20.2814 135.491Z" fill="white"/>
                                        <path d="M56.4458 135.65H10.4692L10.4586 135.493C10.4323 135.104 9.84568 125.928 12.8068 122.654C13.1006 122.308 13.4633 122.028 13.8715 121.831C14.2796 121.634 14.7243 121.525 15.1769 121.512C17.107 121.457 18.32 122.183 19.2984 122.765C21.1426 123.864 22.3606 124.589 26.7901 119.092C31.5882 113.138 36.7656 111.856 39.7417 112.569C41.6647 113.029 42.99 114.33 43.3779 116.138C43.746 117.851 43.6282 119.459 43.5341 120.752C43.4334 122.136 43.354 123.228 43.9198 123.723C44.3932 124.137 45.3348 124.174 46.8862 123.842C50.0417 123.166 54.4457 123.744 56.6559 126.612C57.845 128.154 58.7819 130.958 56.492 135.557L56.4458 135.65ZM10.7829 135.314H56.2388C57.9451 131.838 57.9985 128.902 56.3916 126.817C54.3639 124.186 50.1101 123.494 46.9559 124.17C45.2701 124.531 44.2659 124.471 43.7003 123.977C43.0084 123.371 43.0934 122.205 43.2006 120.729C43.2932 119.458 43.4081 117.875 43.051 116.21C42.6913 114.533 41.4567 113.325 39.6639 112.896C36.7827 112.206 31.7489 113.471 27.0496 119.304C22.4389 125.026 21.0497 124.199 19.1278 123.053C18.1372 122.464 17.0128 121.795 15.1861 121.847C14.7786 121.86 14.3785 121.959 14.0113 122.136C13.6441 122.314 13.318 122.567 13.054 122.879C10.3934 125.822 10.7179 134.073 10.7831 135.314H10.7829Z" fill="#2F2E41"/>
                                        <path d="M239.527 135.472H0.5V136H239.527V135.472Z" fill="#3F3D56"/>
                                        <path d="M104.903 131.869H101.074L99.251 117.037H104.905L104.903 131.869Z" fill="#FEB8B8"/>
                                        <path d="M93.6885 135.439H105.724V130.77H98.2742C97.058 130.77 95.8916 131.255 95.0316 132.118C94.1716 132.982 93.6885 134.153 93.6885 135.374V135.439Z" fill="#2F2E41"/>
                                        <path d="M103.558 108.886L106.199 111.67L118.151 102.765L114.253 98.6558L103.558 108.886Z" fill="#FEB8B8"/>
                                        <path d="M108.92 112.946L103.78 107.53L100.413 110.752L108.718 119.501L108.764 119.456C109.2 119.039 109.55 118.54 109.794 117.987C110.038 117.434 110.171 116.838 110.185 116.234C110.2 115.629 110.095 115.027 109.878 114.463C109.661 113.899 109.336 113.384 108.92 112.946Z" fill="#2F2E41"/>
                                        <path d="M76.9021 68.2516C76.6597 67.8601 76.5058 67.42 76.4511 66.9622C76.3964 66.5045 76.4423 66.0403 76.5856 65.6023C76.7288 65.1644 76.966 64.7632 77.2803 64.4272C77.5946 64.0912 77.9785 63.8284 78.4049 63.6574L93.4404 25.1807L99.3012 28.7042L82.5988 65.616C82.8374 66.3545 82.798 67.1552 82.4879 67.8665C82.1779 68.5777 81.6187 69.15 80.9165 69.4749C80.2142 69.7998 79.4176 69.8547 78.6778 69.6293C77.9379 69.4038 77.306 68.9136 76.9021 68.2516Z" fill="#FEB8B8"/>
                                        <path d="M133.973 71.0095C133.515 70.9766 133.069 70.8432 132.668 70.6188C132.267 70.3943 131.92 70.0843 131.651 69.7104C131.382 69.3366 131.198 68.9081 131.112 68.4551C131.025 68.0021 131.039 67.5356 131.152 67.0886L108.971 32.2708L115.253 29.5776L135.195 64.8322C135.931 65.0712 136.554 65.5734 136.946 66.2435C137.338 66.9135 137.472 67.7048 137.321 68.467C137.17 69.2292 136.746 69.9094 136.129 70.3782C135.512 70.8471 134.744 71.0721 133.973 71.0105V71.0095Z" fill="#FEB8B8"/>
                                        <path d="M93.5879 64.399L97.5141 122.991L106.897 122.16L108.829 78.9321L114.072 97.4974L125.386 98.3286L120.908 61.6279L93.5879 64.399Z" fill="#2F2E41"/>
                                        <path d="M115.728 94.7266L114.072 97.4976L102.482 105.533L110.761 109.967C110.761 109.967 126.767 101.1 125.387 98.3288L115.728 94.7266Z" fill="#2F2E41"/>
                                        <path d="M85.3711 40.693L88.6373 31.4519C89.3639 29.3957 90.4895 27.5046 91.9489 25.8881C93.4082 24.2716 95.1723 22.9617 97.1392 22.0343C101.56 20.399 106.368 20.1347 110.94 21.2757L112.129 21.572C115.298 22.3434 118.268 23.7835 120.84 25.7965C122.853 27.3897 124.663 29.4069 124.825 31.5767C124.825 31.5814 124.827 31.5859 124.828 31.5902C125.386 34.0436 125.662 46.7898 125.662 46.7898H120.745L121.522 63.9697L121.459 63.8453C121.459 63.8453 93.0981 69.2345 93.0981 66.4635V48.7289L92.5167 42.3076L85.3711 40.693Z" fill="#CCCCCC"/>
                                        <path d="M111.844 18.8735C116.185 18.8735 119.703 15.3402 119.703 10.9818C119.703 6.62332 116.185 3.09009 111.844 3.09009C107.503 3.09009 103.984 6.62332 103.984 10.9818C103.984 15.3402 107.503 18.8735 111.844 18.8735Z" fill="#FEB8B8"/>
                                        <path d="M113.022 7.44272L119.125 7.68827C119.893 7.68589 120.731 7.6587 121.316 7.1602C122.197 6.40797 122.049 4.98853 121.578 3.92817C120.263 0.975753 117.33 -0.0819627 114.11 0.00490427C110.889 0.0917712 107.515 1.18777 105.781 3.91259C104.046 6.63742 103.578 10.0783 104.231 13.2446C104.986 11.6346 106.149 10.2516 107.602 9.23372C109.056 8.21583 110.751 7.59865 112.516 7.44378L113.022 7.44272Z" fill="#2F2E41"/>
                                        <path d="M149.261 84.6346L127.172 69.0902C126.967 68.9452 126.827 68.7244 126.784 68.4762C126.74 68.2281 126.797 67.9727 126.94 67.7661L144.277 42.9278C144.422 42.7217 144.642 42.5815 144.889 42.5378C145.136 42.4942 145.39 42.5507 145.596 42.6949L167.685 58.2393C167.89 58.3843 168.03 58.6051 168.073 58.8532C168.117 59.1014 168.06 59.3567 167.917 59.5634L150.58 84.4011C150.436 84.6073 150.216 84.7478 149.969 84.7915C149.721 84.8353 149.467 84.7789 149.261 84.6346Z" fill="#7E171B"/>
                                        <path d="M154.229 67.7677L141.268 58.6465C141.118 58.541 140.99 58.4069 140.892 58.2518C140.793 58.0968 140.727 57.9238 140.695 57.7428C140.663 57.5618 140.667 57.3763 140.707 57.1969C140.747 57.0174 140.821 56.8476 140.926 56.6971C141.031 56.5466 141.165 56.4184 141.319 56.3197C141.474 56.221 141.646 56.1538 141.826 56.122C142.006 56.0902 142.191 56.0943 142.37 56.1341C142.549 56.174 142.718 56.2488 142.868 56.3543L155.829 65.4755C156.132 65.6885 156.338 66.0136 156.402 66.3791C156.466 66.7447 156.383 67.1208 156.17 67.4248C155.958 67.7288 155.634 67.9357 155.27 67.9999C154.906 68.0642 154.532 67.9807 154.229 67.7677Z" fill="white"/>
                                        <path d="M151.253 72.0293L138.292 62.9081C138.142 62.8027 138.014 62.6687 137.916 62.5136C137.817 62.3585 137.75 62.1855 137.718 62.0044C137.687 61.8233 137.691 61.6377 137.73 61.4581C137.77 61.2786 137.845 61.1087 137.95 60.9581C138.055 60.8075 138.188 60.6792 138.343 60.5805C138.497 60.4818 138.67 60.4146 138.85 60.3829C139.031 60.3511 139.215 60.3553 139.394 60.3953C139.573 60.4353 139.742 60.5103 139.892 60.616L152.853 69.7372C153.156 69.9503 153.361 70.2753 153.425 70.6407C153.489 71.0061 153.406 71.382 153.194 71.6858C152.982 71.9896 152.658 72.1964 152.294 72.2608C151.931 72.3252 151.556 72.242 151.253 72.0293Z" fill="white"/>
                                        <path d="M148.248 76.337L135.286 67.2158C135.136 67.1103 135.009 66.9762 134.91 66.8212C134.812 66.6661 134.745 66.4932 134.713 66.3121C134.682 66.1311 134.686 65.9456 134.726 65.7662C134.765 65.5868 134.84 65.417 134.945 65.2665C135.05 65.116 135.183 64.9877 135.338 64.889C135.492 64.7903 135.664 64.7232 135.845 64.6913C136.025 64.6595 136.21 64.6636 136.388 64.7035C136.567 64.7433 136.736 64.8181 136.886 64.9236L149.847 74.0448C150.15 74.2578 150.356 74.5829 150.42 74.9485C150.484 75.314 150.401 75.6902 150.189 75.9941C149.977 76.2981 149.653 76.505 149.289 76.5693C148.925 76.6336 148.55 76.55 148.248 76.337Z" fill="white"/>
                                        <path d="M154.192 59.337L149.172 55.8041C149.022 55.6987 148.894 55.5647 148.796 55.4096C148.697 55.2545 148.63 55.0815 148.598 54.9004C148.567 54.7193 148.571 54.5337 148.61 54.3541C148.65 54.1746 148.724 54.0047 148.83 53.8541C148.935 53.7035 149.068 53.5752 149.223 53.4765C149.377 53.3778 149.55 53.3106 149.73 53.2789C149.911 53.2471 150.095 53.2513 150.274 53.2913C150.453 53.3313 150.622 53.4063 150.772 53.512L155.792 57.0449C156.095 57.2579 156.301 57.583 156.365 57.9485C156.429 58.3141 156.346 58.6902 156.134 58.9942C155.922 59.2982 155.598 59.505 155.234 59.5693C154.87 59.6336 154.495 59.5501 154.192 59.337Z" fill="white"/>
                                    </svg>
                                </div>
                                <DialogTitle
                                    :as="'div'"
                                    class="flex flex-col justify-center items-center self-stretch gap-1 px-6"
                                >
                                    <p class="text-center text-primary-900 text-lg font-medium self-stretch">{{ props.confirmationTitle }}</p>
                                    <p class="text-center text-grey-900 text-base font-medium self-stretch">{{ props.confirmationMessage }}</p>
                                </DialogTitle>
                                <div class="flex px-6 pb-6 justify-center items-end gap-4 self-stretch">
                                    <Button
                                        :type="'button'"
                                        :variant="'tertiary'"
                                        :size="'lg'"
                                        @click="close"
                                    >
                                        Keep
                                    </Button>
                                    <Button
                                        :type="'button'"
                                        :variant="'red'"
                                        :size="'lg'"
                                        @click="deleteRecord"
                                    >
                                        Delete
                                    </Button>
                                </div>
                            </template>
                        </DialogPanel>
                    </TransitionChild>
                </div>
            </div>
        </Dialog>
    </TransitionRoot>
</template>

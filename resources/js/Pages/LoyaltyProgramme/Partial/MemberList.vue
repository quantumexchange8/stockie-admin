<script setup>
import Table from "@/Components/Table.vue";
import { ref, onMounted, defineProps } from "vue";
import Button from "@/Components/Button.vue";
import axios from "axios";

const props = defineProps({
    id: String,
});

const columns = ref([
    { field: "full_name", header: "Member name", width: "50", sortable: false },
    { field: "created_at", header: "Joined on", width: "30", sortable: true },
    {
        field: "total_spend",
        header: "Total spent ",
        width: "20",
        sortable: true,
    },
]);
const actions = {
    // Define your actions if needed
};

const customer = ref([]);
const totalPages = ref(12);
const rowsPerPage = ref(11);
const customerCount = ref(0);

const rowType = {
    rowGroups: false,
    expandable: false,
    groupRowsBy: "name",
};

const formatCreatedAt = (createdAt) => {
    const date = new Date(createdAt.replace("T", " ")); // Replace 'T' with a space for parsing
    const day = date.getDate().toString().padStart(2, "0");
    const month = (date.getMonth() + 1).toString().padStart(2, "0"); // Month is zero-based
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
};

const getData = () => {
    axios
        .get(`/loyalty-programme/getMemberList?id=${props.id}`)
        .then((response) => {
            customer.value = response.data.customers.map((item) => ({
                ...item,
                created_at: formatCreatedAt(item.created_at),
            }));
            customerCount.value = response.data.count;
        })
        .catch((error) => {
            console.error("Error fetching customers:", error);
        });
};

onMounted(() => {
    getData();
});
</script>

<template>
    <div class="flex gap-[10px]">
        <span class="w-full text-primary-900 text-md font-medium">
            Member List ({{ customerCount }})
        </span>
        <div class="w-fit">
            <Button
                variant="tertiary"
                :type="'button'"
                :size="'lg'"
                :iconPosition="'right'"
            >
                Export<template #icon>
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                    >
                        <path
                            d="M14 10V10.8C14 11.9201 14 12.4802 13.782 12.908C13.5903 13.2843 13.2843 13.5903 12.908 13.782C12.4802 14 11.9201 14 10.8 14H5.2C4.07989 14 3.51984 14 3.09202 13.782C2.71569 13.5903 2.40973 13.2843 2.21799 12.908C2 12.4802 2 11.9201 2 10.8V10M11.3333 5.33333L8 2M8 2L4.66667 5.33333M8 2V10"
                            stroke="#7E171B"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        />
                    </svg>
                </template>
            </Button>
        </div>
    </div>
    <Table
        :variant="'list'"
        :rows="customer"
        :totalPages="totalPages"
        :columns="columns"
        :rowsPerPage="rowsPerPage"
        :rowType="rowType"
        :actions="actions"
    >
        <template #empty>
            <div class="flex flex-col items-center">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 396 387"
                    fill="none"
                >
                    <g filter="url(#filter0_f_756_28638)">
                        <ellipse
                            cx="198"
                            cy="197.042"
                            rx="86"
                            ry="85"
                            fill="#FFF1F2"
                        />
                    </g>
                    <path
                        d="M189.5 253.958C232.302 253.958 267 219.484 267 176.958C267 134.432 232.302 99.9578 189.5 99.9578C146.698 99.9578 112 134.432 112 176.958C112 219.484 146.698 253.958 189.5 253.958Z"
                        fill="url(#paint0_linear_756_28638)"
                    />
                    <path
                        d="M245.901 255.357L159.902 244.437C157.623 244.148 156.011 242.066 156.3 239.788L170.296 129.568C170.585 127.289 172.667 125.677 174.945 125.966L260.945 136.886C263.223 137.176 264.836 139.257 264.546 141.536L250.551 251.756C250.261 254.034 248.18 255.647 245.901 255.357Z"
                        fill="#FFC7C9"
                    />
                    <path
                        opacity="0.2"
                        d="M236.632 144.243H161.04C159.93 144.243 158.965 145.115 158.884 146.189L150.476 257.898C150.395 258.972 151.23 259.843 152.34 259.843H243.327C244.437 259.843 245.402 258.972 245.483 257.898L252.769 161.092L236.632 144.243Z"
                        fill="#7E171B"
                    />
                    <path
                        d="M244.792 158.34V258.346C244.792 258.805 244.637 259.231 244.377 259.569V259.57C244.008 260.048 243.431 260.357 242.781 260.357H151.795C150.684 260.357 149.784 259.457 149.784 258.346V142.945C149.784 141.834 150.684 140.934 151.795 140.934H227.386L244.792 158.34Z"
                        fill="#FFF9F9"
                    />
                    <path
                        d="M229.755 158.341H244.79L227.384 140.935V155.969C227.384 157.279 228.446 158.341 229.755 158.341Z"
                        fill="#FFF1F2"
                    />
                    <g opacity="0.2">
                        <path
                            d="M199.949 179.601C200.594 177.554 201.904 175.687 203.881 174.001C205.857 172.313 208.324 171.178 211.279 170.594C214.234 170.009 217.394 170.246 220.755 171.305C223.879 172.289 226.456 173.735 228.484 175.642C230.513 177.548 231.866 179.698 232.546 182.091C233.224 184.485 233.197 186.844 232.464 189.171C231.887 191.004 231.009 192.492 229.832 193.636C228.653 194.781 227.395 195.693 226.056 196.373C224.716 197.052 222.348 198.159 218.951 199.694C218.008 200.132 217.235 200.534 216.634 200.901C216.033 201.268 215.558 201.628 215.211 201.98C214.863 202.333 214.563 202.7 214.312 203.083C214.061 203.466 213.651 204.148 213.081 205.129C211.965 207.241 210.331 207.957 208.176 207.278C207.055 206.925 206.227 206.262 205.695 205.288C205.159 204.315 205.12 203.106 205.575 201.663C206.146 199.852 206.919 198.373 207.898 197.224C208.875 196.076 209.985 195.147 211.228 194.436C212.469 193.726 214.095 192.93 216.103 192.047C217.861 191.274 219.145 190.677 219.953 190.257C220.76 189.836 221.493 189.316 222.151 188.694C222.809 188.072 223.277 187.32 223.555 186.436C224.098 184.712 223.916 183.055 223.007 181.466C222.098 179.877 220.631 178.763 218.606 178.125C216.236 177.378 214.302 177.426 212.804 178.269C211.307 179.112 209.804 180.575 208.295 182.657C206.795 184.862 205.021 185.641 202.975 184.996C201.767 184.616 200.883 183.869 200.322 182.756C199.761 181.644 199.636 180.593 199.949 179.601ZM204.559 219.996C203.246 219.582 202.232 218.794 201.519 217.634C200.807 216.474 200.692 215.13 201.174 213.599C201.602 212.242 202.436 211.249 203.676 210.622C204.916 209.994 206.225 209.897 207.604 210.332C208.963 210.76 209.958 211.582 210.593 212.801C211.227 214.02 211.331 215.307 210.903 216.665C210.428 218.174 209.57 219.206 208.329 219.763C207.087 220.318 205.831 220.396 204.559 219.996Z"
                            fill="#7E171B"
                        />
                    </g>
                    <path
                        d="M192.584 182.34C192.854 180.211 193.811 178.14 195.456 176.129C197.101 174.117 199.326 172.561 202.13 171.459C204.934 170.358 208.085 170.029 211.581 170.473C214.83 170.885 217.624 171.85 219.959 173.365C222.294 174.88 224.009 176.754 225.104 178.988C226.198 181.222 226.591 183.549 226.284 185.969C226.041 187.875 225.443 189.496 224.488 190.831C223.532 192.168 222.456 193.289 221.26 194.197C220.062 195.103 217.929 196.614 214.859 198.73C214.009 199.328 213.32 199.861 212.795 200.33C212.268 200.798 211.865 201.236 211.586 201.645C211.306 202.053 211.076 202.469 210.898 202.89C210.719 203.312 210.436 204.055 210.051 205.122C209.328 207.399 207.847 208.395 205.607 208.11C204.441 207.962 203.508 207.458 202.81 206.594C202.111 205.731 201.857 204.549 202.048 203.047C202.287 201.164 202.784 199.571 203.543 198.267C204.3 196.962 205.228 195.85 206.324 194.93C207.419 194.011 208.877 192.938 210.695 191.711C212.288 190.638 213.446 189.822 214.166 189.265C214.885 188.707 215.514 188.064 216.05 187.335C216.587 186.606 216.913 185.783 217.03 184.863C217.258 183.07 216.783 181.472 215.606 180.07C214.429 178.668 212.787 177.834 210.681 177.566C208.215 177.253 206.321 177.644 204.997 178.741C203.673 179.836 202.455 181.544 201.341 183.861C200.257 186.298 198.651 187.381 196.522 187.11C195.266 186.951 194.263 186.374 193.513 185.378C192.763 184.384 192.453 183.371 192.584 182.34ZM204.311 221.269C202.944 221.095 201.807 220.501 200.899 219.486C199.991 218.472 199.639 217.169 199.841 215.577C200.02 214.165 200.665 213.04 201.773 212.202C202.881 211.363 204.153 211.035 205.587 211.217C207 211.397 208.126 212.029 208.968 213.115C209.808 214.201 210.14 215.45 209.96 216.862C209.761 218.431 209.1 219.6 207.978 220.369C206.856 221.137 205.633 221.436 204.311 221.269Z"
                        fill="#7E171B"
                    />
                    <path
                        opacity="0.2"
                        d="M219.6 235.226C219.51 239.838 218.145 244.395 215.789 248.463C213.644 252.173 210.672 255.476 207.094 258.043C206.851 258.218 206.605 258.388 206.356 258.556H175.992C175.785 258.39 175.584 258.219 175.384 258.043C172.697 255.687 170.601 252.645 169.343 249.061L163.928 250.673L163.997 251.058C164.165 251.983 163.521 252.964 162.561 253.25L160.646 253.82H160.644L159.781 254.077V242.134L160.511 241.916C160.873 241.808 161.23 241.816 161.542 241.915C162.056 242.08 162.449 242.497 162.553 243.071L162.622 243.458L167.965 241.867L168.037 241.845C167.955 238.635 168.499 235.432 169.576 232.385C172.631 223.742 179.967 216.35 189.398 213.541C203.428 209.365 216.78 216.916 219.22 230.409C219.51 232.008 219.633 233.621 219.6 235.226Z"
                        fill="#7E171B"
                    />
                    <path
                        d="M168.476 247.125L166.242 239.91L157.8 242.523L160.033 249.738L168.476 247.125Z"
                        fill="#7E171B"
                    />
                    <path
                        d="M124.551 261.15L122.079 253.163C121.793 252.24 122.31 251.259 123.234 250.973L156.435 240.694C157.359 240.408 158.34 240.925 158.626 241.849L161.098 249.836C161.384 250.76 160.867 251.741 159.943 252.027L126.742 262.305C125.818 262.591 124.838 262.074 124.551 261.15Z"
                        fill="#9F151A"
                    />
                    <path
                        d="M207.314 254.834C217.301 244.846 217.301 228.654 207.314 218.667C197.327 208.679 181.134 208.679 171.147 218.667C161.16 228.654 161.16 244.846 171.147 254.834C181.134 264.821 197.327 264.821 207.314 254.834Z"
                        fill="#9F151A"
                    />
                    <path
                        d="M203.037 250.556C210.662 242.931 210.662 230.569 203.037 222.944C195.412 215.319 183.05 215.319 175.425 222.944C167.8 230.569 167.8 242.931 175.425 250.556C183.05 258.181 195.412 258.181 203.037 250.556Z"
                        fill="white"
                    />
                    <path
                        d="M183.613 249.044C183.356 249.044 183.095 248.983 182.851 248.855C182.051 248.433 181.744 247.442 182.166 246.642L193.402 225.329C193.824 224.529 194.814 224.223 195.614 224.644C196.414 225.066 196.721 226.057 196.299 226.857L185.063 248.17C184.77 248.726 184.201 249.044 183.613 249.044Z"
                        fill="#9F151A"
                    />
                    <path
                        d="M199.888 244.005C199.63 244.005 199.369 243.944 199.125 243.816L177.813 232.58C177.013 232.158 176.706 231.168 177.128 230.367C177.55 229.567 178.54 229.261 179.34 229.682L200.653 240.918C201.453 241.34 201.76 242.331 201.338 243.131C201.045 243.687 200.476 244.005 199.888 244.005Z"
                        fill="#9F151A"
                    />
                    <defs>
                        <filter
                            id="filter0_f_756_28638"
                            x="0.599998"
                            y="0.642235"
                            width="394.8"
                            height="392.8"
                            filterUnits="userSpaceOnUse"
                            color-interpolation-filters="sRGB"
                        >
                            <feFlood
                                flood-opacity="0"
                                result="BackgroundImageFix"
                            />
                            <feBlend
                                mode="normal"
                                in="SourceGraphic"
                                in2="BackgroundImageFix"
                                result="shape"
                            />
                            <feGaussianBlur
                                stdDeviation="55.7"
                                result="effect1_foregroundBlur_756_28638"
                            />
                        </filter>
                        <linearGradient
                            id="paint0_linear_756_28638"
                            x1="147.338"
                            y1="167.703"
                            x2="189.06"
                            y2="254.17"
                            gradientUnits="userSpaceOnUse"
                        >
                            <stop stop-color="#FFF1F2" />
                            <stop
                                offset="1"
                                stop-color="white"
                                stop-opacity="0"
                            />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="text-primary-900 text-sm font-medium"
                    >No data can be shown yet...</span
                >
            </div>
        </template>

        <template #full_name="row">
            <div class="flex gap-[10px]">
                <div class="w-[32px] h-[32px] rounded-full bg-gray-500"></div>
                <span class="">{{ row.full_name }}</span>
            </div>
        </template>
        <template #created_at="row">
            <span class=""> {{ row.created_at }}</span>
        </template>
        <template #total_spend="row">
            <span class=""> RM {{ row.total_spend }}</span>
        </template>
    </Table>
</template>
